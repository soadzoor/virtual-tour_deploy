(()=>{var ce=class{static get DEFAULT_ZOOM_FACTOR(){return ce.MIN_ZOOM_FACTOR}static get isFullscreenAvailable(){let e=document.body;return!!e.requestFullscreen||!!e.webkitRequestFullscreen||!!e.mozRequestFullScreen||!!e.msRequestFullscreen}static get isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}static get isMac(){return/Mac/.test(navigator.userAgent)&&!window.MSStream}static get browserName(){if((navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1)return"Opera";if(navigator.userAgent.indexOf("Chrome")!=-1)return navigator.platform.indexOf("Mac")>-1?"Chrome - Mac":"Chrome";if(navigator.userAgent.indexOf("Safari")!=-1)return"Safari";if(navigator.userAgent.indexOf("Firefox")!=-1)return"Firefox";if(navigator.userAgent.indexOf("MSIE")!=-1||!!document.documentMode)return"IE"}},p=ce;p.API_HOST="http://localhost:8080",p.SNACKBAR_AUTOHIDE_DURATION=6e3,p.TRANSITION_DURATION=400,p.ANIMATION_DURATION=2e3,p.FOV=75,p.POINTER_SENSITIVITY=1.2,p.MIN_ZOOM_FACTOR=1,p.WORLD_UP=[0,1,0],p.CAMERA_POSITION=[0,0,0],p.AUTOROTATION_SPEEDS={default:3e-5,fast:9e-4},p.MOUSE_BUTTON={LEFT:0,MIDDLE:1,RIGHT:2},p.clickThreshold={movement:3,time:1e3,longTap:1e3};var x=class{static lengthOfSquared(e){let t=0;for(let i of e)t+=i*i;return t}static lengthOf(e){return Math.sqrt(x.lengthOfSquared(e))}static normalize(e){let t=x.lengthOf(e);for(let i=0;i<e.length;++i)e[i]/=t;return e}static dotProduct(e,t){let i=0;for(let r=0;r<e.length;++r)i+=e[r]*t[r];return i}static subVectors(e,t){let i=[];for(let r=0;r<e.length;++r)i.push(e[r]-t[r]);return i}static addVectors(e,t){let i=[];for(let r=0;r<e.length;++r)i.push(e[r]+t[r]);return i}static crossVectors(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}static multiplyByScalar(e,t){let i=[];for(let r=0;r<e.length;++r)i[r]=e[r]*t;return i}static setFromMatrixPosition(e){let t=e.elements;return[t[12],t[13],t[14]]}static distanceBetweenSquared(e,t){let i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}static setQuaternionFromVector3(e){let t=Math.cos,i=Math.sin,r=t(e[0]/2),s=t(e[1]/2),o=t(e[2]/2),n=i(e[0]/2),a=i(e[1]/2),l=i(e[2]/2);return[n*s*o+r*a*l,r*a*o-n*s*l,r*s*l+n*a*o,r*s*o-n*a*l]}static setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],n=t[5],a=t[9],l=t[2],u=t[6],c=t[10],m=i+n+c,h,_,b,g,d;return m>0?(h=.5/Math.sqrt(m+1),_=.25/h,b=(u-a)*h,g=(s-l)*h,d=(o-r)*h):i>n&&i>c?(h=2*Math.sqrt(1+i-n-c),_=(u-a)/h,b=.25*h,g=(r+o)/h,d=(s+l)/h):n>c?(h=2*Math.sqrt(1+n-i-c),_=(s-l)/h,b=(r+o)/h,g=.25*h,d=(a+u)/h):(h=2*Math.sqrt(1+c-i-n),_=(o-r)/h,b=(s+l)/h,g=(a+u)/h,d=.25*h),[b,g,d,_]}setFromMatrixPosition(e){let t=e.elements;return[t[12],t[13],t[14]]}};var v=class{static clamp(e,t,i){return e<=t?t:e>=i?i:e}static isValidNumber(e){return!(e===null||e===void 0||isNaN(e)||e===Infinity||e===-Infinity)}static deg2rad(e){return Math.PI/180*e}static rad2deg(e){return 180/Math.PI*e}static getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static getForwardLengthFromFOV(e){return 1/Math.tan(v.deg2rad(e/2))}static getNormalizedCursorCoords(e,t,i){return[2*(e/i[0]-.5),2*((i[1]-t)/i[1]-.5)]}static getSphereSurfacePointFromUV(e,t){let i=[Math.cos(e)*Math.sin(t),Math.cos(t),Math.sin(e)*Math.sin(t)];return x.normalize(i)}static getUVFromSphereSufracePoint(e){let t=x.normalize(e),i=1-(Math.PI-Math.atan2(t[2],t[0]))/(2*Math.PI),r=(Math.PI/2-Math.asin(-t[1]))/Math.PI;return[i,r]}static getLongitudeLatitudeFromUV(e){return[2*Math.PI*((e[0]+.5)%1),Math.PI*(e[1]-.5)]}static isPowerOfTwo(e){return(e&e-1)==0&&e!==0}static ceilPowerOfTwo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}};var T;(function(M){M[M.EASE_OUT=0]="EASE_OUT",M[M.EASE_IN_OUT=1]="EASE_IN_OUT"})(T||(T={}));var R=class{constructor(e,t,i=0,r=p.ANIMATION_DURATION,s=!0){this._timeStampAtSetEnd=0;this._min=-Infinity;this._max=Infinity;this._hasChanged=!1;this._prevDeltaValue=0;this._prevTimeStamp=1;this._prevDeltaTime=1;this._easing=0;this._timeoutId=-1;this._originalStart=e,this._start=e,this._originalEnd=t,this._end=t,this._value=this._start,this._originalAnimationDuration=this._animationDuration=r,this._easing=i,this._triggerRender=s}static removeFromActiveOnes(e){R._activeInstances=R._activeInstances.filter(t=>t!==e)}static addToActiveOnes(e){R._activeInstances.includes(e)||R._activeInstances.push(e)}static updateActiveOnes(e){let t=!1;for(let i of R._activeInstances)t=t||i._triggerRender,i.update(e);return t}smoothStep(e){if(e<this._animationDuration){let t=e/this._animationDuration;return v.clamp(t**2*(3-2*t)*(this._end-this._start)+this._start,this._min,this._max)}else return this._end=v.clamp(this._end,this._min,this._max),this._end}exponentialOut(e){if(e<this._animationDuration){let t=e/this._animationDuration;return v.clamp((1-2**(-10*t))*(1024/1023)*(this._end-this._start)+this._start,this._min,this._max)}else return this._end=v.clamp(this._end,this._min,this._max),this._end}getNextValue(e){return this._easing===1?this.smoothStep(e):this.exponentialOut(e)}increaseEndBy(e,t=!1){this.setEnd(this._end+e,t)}decreaseEndBy(e,t=!1){this.setEnd(this._end-e,t)}setEnd(e,t=!1,i=this._originalAnimationDuration){this._animationDuration=i;let r=t?v.clamp(e,this._min,this._max):e;R.addToActiveOnes(this),this._start=this._value,this._end=r,this._timeStampAtSetEnd=I.timeStamp,t||(clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(()=>{this._end=v.clamp(this._end,this._min,this._max)},this._animationDuration))}reset(e,t,i=this._originalAnimationDuration){this._animationDuration=i,R.addToActiveOnes(this),this._start=e!=null?e:this._originalStart,this._end=t!=null?t:this._originalEnd,this._timeStampAtSetEnd=I.timeStamp}update(e){this._prevDeltaTime=e-this._prevTimeStamp;let t=e-this._timeStampAtSetEnd,i=this._value;this._value=this.getNextValue(t),this._prevDeltaValue=this._value-i,this._prevTimeStamp=e,this._value===i?(this._start=this._end,this._hasChanged=!1,R.removeFromActiveOnes(this)):this._hasChanged=!0}get animationDuration(){return this._animationDuration}get originalAnimationDuration(){return this._originalAnimationDuration}get start(){return this._start}get value(){return this._value}get end(){return this._end}get hasChangedSinceLastTick(){return this._hasChanged}get prevDeltaValue(){return this._prevDeltaValue}get prevDeltaTime(){return this._prevDeltaTime}get derivateAt0(){return this._easing===0?6.938247437862991:0}},N=R;N._activeInstances=[];var P=class extends N{constructor(e,t,i,r,s=T.EASE_OUT,o=p.ANIMATION_DURATION,n=!0){super(e,t,s,o,n);this._originalMin=this._min=i,this._originalMax=this._max=r}get min(){return this._min}get max(){return this._max}get originalMin(){return this._originalMin}get originalMax(){return this._originalMax}setMin(e){this._min=e;let t=v.clamp(this._start,this._min,this._max),i=v.clamp(this._end,this._min,this._max);super.reset(t,i)}setMax(e){this._max=e;let t=v.clamp(this._start,this._min,this._max),i=v.clamp(this._end,this._min,this._max);super.reset(t,i)}reset(e,t,i,r,s=!1){this._min=i!=null?i:this._min,this._max=r!=null?r:this._max;let o=e!=null?e:this._originalStart,n=s?v.clamp(o,this._min,this._max):o,a=t!=null?t:this._originalEnd,l=s?v.clamp(a,this._min,this._max):a;super.reset(n,l)}isPlaying(){return this.value!==this.end}};var y=class{constructor(){this._shouldPropagate=!0;this._bindings=[]}static create(){return new y}add(e,t,i=0){this.registerListener(e,!1,t,i)}addAndCall(e,t,i=0){this.registerListener(e,!1,t,i),t=t||this,e.call(t)}addOnce(e,t,i=0){this.registerListener(e,!0,t,i)}registerListener(e,t,i,r=0){let s=this.indexOfListener(e,i),o=null;if(s!==-1){if(o=this._bindings[s],o.isOnce!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o={listener:e,context:i,isOnce:t,priority:r},this.addBinding(o)}addBinding(e){let t=this._bindings.length;do--t;while(this._bindings[t]&&e.priority<=this._bindings[t].priority);this._bindings.splice(t+1,0,e)}indexOfListener(e,t){for(let i=this._bindings.length-1;i>=0;--i){let r=this._bindings[i];if(r.listener===e&&r.context===t)return i}return-1}has(){}halt(){this._shouldPropagate=!1}remove(e,t){let i=this.indexOfListener(e,t);return i!==-1?(this._bindings.splice(i,1),!0):!1}removeAll(){this._bindings.length=0}dispatch(...e){let t=Array.prototype.slice.call(arguments);this._shouldPropagate=!0;let i=this._bindings;for(let r=i.length-1;r>=0&&!(i[r].listener.apply(i[r].context,t)===!1||!this._shouldPropagate);--r);}dispose(){this.removeAll()}get bindings(){return this._bindings}};var ue=class{constructor(e,t){this._isPointerDown=!1;this._mouseMoved=!0;this._pointer={downTimeStamp:null,startX:null,startY:null,prevX:null,prevY:null,prevDeltaX:0,prevDeltaY:0,prevTimeStamp:0,prevDeltaTime:1,triggerClickOnPointerUp:!1};this._u=new P(0,0,-Infinity,Infinity);this._v=new P(Math.PI/2,Math.PI/2,.01,3.14);this._pinch={startValue:{touchDistance:null,zoomValue:null},currentValue:{touchDistance:null,zoomValue:null}};this._forward=[-1,0,0];this._dampingTimeoutId=null;this._longTapTimeoutId=null;this._dampOnPointerUp=!1;this._prevSpeed=[];this._enabled=!1;this._autoRotation=[p.AUTOROTATION_SPEEDS.default,0];this.signals={click:y.create(),longTap:y.create()};this.ignorePinch=e=>{e.touches.length>1&&e.preventDefault(),(p.isIOS||p.isMac)&&(e=e.originalEvent||e,e.scale!==1&&e.preventDefault())};this.preventDefault=e=>{e.preventDefault()};this.onWheel=e=>{e.preventDefault();let t=1.1,i=this._sceneManager.userZoomFactor,r=Math.sign(-e.deltaY)>0?i.end*t:i.end/t;i.setEnd(r,!0)};this.onMouseDown=e=>{e.button===p.MOUSE_BUTTON.LEFT&&this.onPointerDown(e.clientX,e.clientY)};this.onTouchStart=e=>{e.preventDefault(),e.touches.length===1?this.onPointerDown(e.touches[0].clientX,e.touches[0].clientY):e.touches.length===2?(this._pinch.startValue.touchDistance=this.getTouchDistance(e),this._pinch.startValue.zoomValue=this._sceneManager.userZoomFactor.value):this.onPointerUp()};this.onMouseMove=e=>{this.onPointerMove(e.clientX,e.clientY)};this.onTouchMove=e=>{e.preventDefault(),e.touches.length===1?this.onPointerMove(e.touches[0].clientX,e.touches[0].clientY):e.touches.length===2&&this._pinch.startValue.touchDistance?(this._pinch.currentValue.touchDistance=this.getTouchDistance(e),this._pinch.currentValue.zoomValue=this._pinch.currentValue.touchDistance/this._pinch.startValue.touchDistance*this._pinch.startValue.zoomValue,this._sceneManager.userZoomFactor.setEnd(this._pinch.currentValue.zoomValue)):this.onPointerUp()};this.onPointerUp=()=>{if(this._isPointerDown){let e=performance.now();this._domElement.classList.remove("rotating");let t=this._prevSpeed,i=x.lengthOfSquared(t);if(this._dampOnPointerUp&&!isNaN(i)&&0<i&&i<Infinity){this._dampOnPointerUp=!1;let r=this._u.derivateAt0,s=this._u.originalAnimationDuration,o=[s*t[0]/r,s*t[1]/r];this._u.setEnd(this._u.value+o[0]),this._v.setEnd(this._v.value+o[1])}p.clickThreshold.time<e-this._pointer.downTimeStamp&&(this._pointer.triggerClickOnPointerUp=!1),this._pointer.triggerClickOnPointerUp&&this.signals.click.dispatch({clientX:this._pointer.prevX,clientY:this._pointer.prevY})}clearTimeout(this._longTapTimeoutId),this._isPointerDown=!1,this._pointer.triggerClickOnPointerUp=!1,this._pointer.downTimeStamp=null,this._pointer.startX=null,this._pointer.startY=null,this._pointer.prevX=null,this._pointer.prevY=null,this._pointer.prevTimeStamp=0,this._pointer.prevDeltaX=0,this._pointer.prevDeltaY=0,this._pointer.prevDeltaTime=1,this._pinch.startValue.touchDistance=this._pinch.startValue.zoomValue=this._pinch.currentValue.touchDistance=this._pinch.currentValue.zoomValue=null};this.cancelDamping=()=>{this._dampOnPointerUp=!1};this._domElement=e,this._sceneManager=t,this.disableDefaultZoomGesture()}disableDefaultZoomGesture(){window.addEventListener("touchstart",this.ignorePinch,{passive:!1}),window.addEventListener("touchmove",this.ignorePinch,{passive:!1}),window.addEventListener("gesturestart",this.preventDefault,{passive:!1}),window.addEventListener("gesturechange",this.preventDefault,{passive:!1})}getTouchDistance(e){let t={x:e.touches[0].clientX,y:e.touches[0].clientY},i={x:e.touches[1].clientX,y:e.touches[1].clientY},r={x:i.x-t.x,y:i.y-t.y};return Math.sqrt(r.x*r.x+r.y*r.y)}onPointerDown(e,t){this.stopRotating(),this._isPointerDown=!0,this._mouseMoved=!1,this._pointer.startX=this._pointer.prevX=e,this._pointer.startY=this._pointer.prevY=t,this._pointer.downTimeStamp=performance.now(),this._pointer.prevTimeStamp=this._pointer.downTimeStamp,this._pointer.triggerClickOnPointerUp=!0,this._domElement.classList.add("rotating"),this._longTapTimeoutId=window.setTimeout(()=>{this.signals.longTap.dispatch({clientX:e,clientY:t})},p.clickThreshold.longTap),this._u.reset(this._u.value,this._u.value),this._v.reset(this._v.value,this._v.value)}onPointerMove(e,t){if(this._isPointerDown&&(this._mouseMoved=e!==this._pointer.prevX||t!==this._pointer.prevY,this._mouseMoved)){if(this._domElement.classList.add("rotating"),this._pointer.prevX!=null&&this._pointer.prevY!=null){let r=this._sceneManager.userZoomFactor.value,s=(e-this._pointer.prevX)*p.POINTER_SENSITIVITY/window.innerHeight/r,o=(t-this._pointer.prevY)*p.POINTER_SENSITIVITY/window.innerHeight/r,n=this._u.end-s,a=this._v.end-o,l=this._pointer.startX-e,u=this._pointer.startY-t;(p.clickThreshold.movement<Math.abs(l)||p.clickThreshold.movement<Math.abs(u))&&(this._pointer.triggerClickOnPointerUp=!1,clearTimeout(this._longTapTimeoutId)),this._u.reset(n,n),this._v.reset(a,a)}this._pointer.prevDeltaX=e-this._pointer.prevX,this._pointer.prevDeltaY=t-this._pointer.prevY,this._pointer.prevX=e,this._pointer.prevY=t;let i=performance.now();p.clickThreshold.time<i-this._pointer.downTimeStamp&&(this._pointer.triggerClickOnPointerUp=!1),this._pointer.prevDeltaTime=i-this._pointer.prevTimeStamp,this._pointer.prevTimeStamp=i,this._dampOnPointerUp=!0,clearTimeout(this._dampingTimeoutId),this._dampingTimeoutId=setTimeout(this.cancelDamping,100)}}setUVFromSphereSufracePoint(e){let t=Math.PI+Math.atan2(-e[2],-e[0]);this._u.reset(t,t);let i=Math.PI/2-Math.asin(e[1]);this._v.reset(i,i)}setHeadingAngle(e,t,i){this._u.reset(e,e),t?this._v.reset(this._v.value,this._v.value):this._v.reset(Math.PI/2,Math.PI/2),i&&(this._autoRotation[0]=0,this._autoRotation[1]=0)}updateRotationLimit(){let e=this._viewBox;if(e){let t=this._domElement.offsetWidth/this._domElement.offsetHeight,i=v.deg2rad(p.FOV),r=2*Math.atan(Math.tan(i/2)*t);if(e[2]-e[0]<1){let s=!1,o=2*Math.PI*(-.5+e[0]),n=2*Math.PI*(-.5+e[2]),a=o,l=n;if(s&&(a+=r/2,l-=r/2),l>a)this._u.setMin(a),this._u.setMax(l);else{let u=(o+n)/2;this._u.setMin(u),this._u.setMax(u)}}else this._u.setMin(this._u.originalMin),this._u.setMax(this._u.originalMax);if(e[3]-e[1]<1){let s=!1,o=e[1]*Math.PI,n=e[3]*Math.PI,a=o,l=n;if(s&&(a+=i/2,l-=i/2),l>a)this._v.setMin(a),this._v.setMax(l);else{let u=(o+n)/2;this._v.setMin(u),this._v.setMax(u)}}else this._v.setMin(this._v.originalMin),this._v.setMax(this._v.originalMax)}}limitRotation(e){this._viewBox=e,this.updateRotationLimit()}setSize(){this.updateRotationLimit()}activate(){this._enabled||(this._enabled=!0,this.setUVFromSphereSufracePoint(this._forward),this._domElement.addEventListener("mousedown",this.onMouseDown),this._domElement.addEventListener("touchstart",this.onTouchStart),this._domElement.addEventListener("wheel",this.onWheel),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("mouseup",this.onPointerUp),window.addEventListener("touchend",this.onPointerUp),window.addEventListener("touchcancel",this.onPointerUp))}deactivate(){this._enabled&&(this._enabled=!1,this._isPointerDown=!1,this._domElement.classList.remove("rotating"),this._domElement.removeEventListener("mousedown",this.onMouseDown),this._domElement.removeEventListener("touchstart",this.onTouchStart),this._domElement.removeEventListener("wheel",this.onWheel),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onPointerUp),window.removeEventListener("touchend",this.onPointerUp),window.removeEventListener("touchcancel",this.onPointerUp))}stopRotating(){this._autoRotation[0]=0,this._autoRotation[1]=0,this._u.reset(this._u.value,this._u.value),this._v.reset(this._v.value,this._v.value)}update(){return(this._autoRotation[0]!==0||this._autoRotation[1]!==0)&&(this._u.reset(this._u.end+this._autoRotation[0]*I.deltaFrame,this._u.end+this._autoRotation[0]*I.deltaFrame),this._v.reset(this._v.end+this._autoRotation[1]*I.deltaFrame,this._v.end+this._autoRotation[1]*I.deltaFrame,void 0,void 0,!0)),(this._u.hasChangedSinceLastTick||this._v.hasChangedSinceLastTick)&&(this._prevSpeed[0]=this._u.prevDeltaValue/this._u.prevDeltaTime,this._prevSpeed[1]=this._v.prevDeltaValue/this._v.prevDeltaTime,this._forward=v.getSphereSurfacePointFromUV(this._u.value,this._v.value),this._sceneManager.needsRender=!0),this._forward}get autoRotation(){return this._autoRotation}get currentHeadingAngle(){let e=this._u.value%(2*Math.PI);return e<0?e+2*Math.PI:e}get forward(){return this._forward}};var se=class{static get vertexShader(){return`precision highp float;
attribute vec3 vertPosition;varying vec3 vsRay;varying vec3 movementDirection;uniform float zoomFactor;uniform vec3 fw;uniform float ratio;void main (){  highp vec4 tmpvar_1;  tmpvar_1.w = 1.0;  tmpvar_1.xyz = (zoomFactor * vertPosition);  gl_Position = tmpvar_1;  vec3 tmpvar_2;  tmpvar_2 = normalize(((fw.yzx * vec3(0.0, 0.0, 1.0)) - (fw.zxy * vec3(1.0, 0.0, 0.0))));  movementDirection = normalize(((vec3(1.0, 0.0, 0.0) * tmpvar_2.zxy) - (vec3(0.0, 0.0, 1.0) * tmpvar_2.yzx)));  vsRay = (((fw * ${v.getForwardLengthFromFOV(p.FOV)}) + (    (ratio * tmpvar_2)   * vertPosition.x)) + (normalize(    ((tmpvar_2.yzx * fw.zxy) - (tmpvar_2.zxy * fw.yzx))  ) * vertPosition.y));}`}static get fragmentShader(){return`#ifdef GL_EXT_shader_texture_lod
	#extension GL_EXT_shader_texture_lod : enable
#endif

precision highp float;

#define PI 3.14159265359
#define SKY vec3(0.1, 0.1, 0.11)
#define EPSILON 0.0001

varying vec3 vsRay;varying vec3 movementDirection;uniform sampler2D textureMap;uniform float maxTextureLevel;uniform bool isBlurOn;uniform bool isX360;uniform bool isY180;uniform vec4 textureViewBox;uniform float alpha;uniform float movementFactor;

// Based on https://www.shadertoy.com/view/ldS3DW
// But optimized (we're using the origo as center, and 1 as radius), + we're always inside the sphere
float intersectSphere(vec3 ro, vec3 rd){	vec3 rc = ro;	float c = dot(rc, rc) - 1.0;	float b = dot(rd, rc);	float d = b*b - c;	float t = -b + sqrt(abs(d));	return t;}

/**
 * x should be between a and b.
 * The result will be between 0 and 1, keeping the proper ratios of x to a and b
 */
float getInterpolation(in float a, in float b, in float x){	return ((x - a) / (b - a));}
vec3 getColor(in vec2 sphereUV, in vec4 textureViewBox){	vec2 imageUV = vec2(		(sphereUV.x - textureViewBox.x) / (textureViewBox.z - textureViewBox.x),		(sphereUV.y - textureViewBox.y) / (textureViewBox.w - textureViewBox.y)	);float mixMultiplier = 0.0;	float blurMultiplier = 0.0;	bool transitionNeeded = false;	float transitionSize = isBlurOn ? 0.01 : 0.001;	if (transitionSize < textureViewBox.y && textureViewBox.y + transitionSize > sphereUV.y)	{		transitionNeeded = true;		blurMultiplier = getInterpolation(textureViewBox.y + transitionSize, 0.0, sphereUV.y);		mixMultiplier = smoothstep(textureViewBox.y + transitionSize, textureViewBox.y, sphereUV.y);	}	else if (textureViewBox.w - transitionSize < sphereUV.y && textureViewBox.w < 1.0 - transitionSize)	{		transitionNeeded = true;		blurMultiplier = getInterpolation(textureViewBox.w - transitionSize, 1.0, sphereUV.y);		mixMultiplier = smoothstep(textureViewBox.w - transitionSize, textureViewBox.w, sphereUV.y);	}	if (transitionSize < textureViewBox.x && sphereUV.x < textureViewBox.x + transitionSize)	{		transitionNeeded = true;		blurMultiplier = max(blurMultiplier, getInterpolation(textureViewBox.x + transitionSize, 0.0, sphereUV.x));		mixMultiplier = max(mixMultiplier, smoothstep(textureViewBox.x + transitionSize, textureViewBox.x, sphereUV.x));	}	else if (textureViewBox.z - transitionSize < sphereUV.x && textureViewBox.z < 1.0 - transitionSize)	{		transitionNeeded = true;		blurMultiplier = max(blurMultiplier, getInterpolation(textureViewBox.z - transitionSize, 1.0, sphereUV.x));		mixMultiplier = max(mixMultiplier, smoothstep(textureViewBox.z - transitionSize, textureViewBox.z, sphereUV.x));	}	vec3 baseSample = texture2DLodEXT(textureMap, imageUV, 0.0).rgb;	if (isBlurOn && transitionNeeded)	{		if (transitionNeeded)		{			blurMultiplier = clamp((0.5 + sqrt(blurMultiplier)) / 1.5, 0.0, 1.0);		}		bool shouldFixVerticalSeam = !isX360 && isY180;		float medianLodLevel = blurMultiplier * max(1.0, (maxTextureLevel - (shouldFixVerticalSeam ? 0.0 : 0.5)));		return mix(			baseSample,			(				(shouldFixVerticalSeam ? vec3(0.0) : 				1.0 * texture2DLodEXT(textureMap, imageUV, medianLodLevel - 1.0).rgb) +				2.0 * texture2DLodEXT(textureMap, imageUV, medianLodLevel).rgb +				1.0 * texture2DLodEXT(textureMap, imageUV, medianLodLevel + 1.0).rgb			) / (4.0 - (shouldFixVerticalSeam ? 1.0 : 0.0)),			mixMultiplier		);	}	else	{		return mix(			baseSample,			SKY,			mixMultiplier		);}}

void main()
{
	vec3 rayOrigin = movementDirection * 0.1 * movementFactor;	vec3 rayDirection = normalize(vsRay);	float t = intersectSphere(rayOrigin, rayDirection);	vec3 hitPoint = rayOrigin + rayDirection * t;	vec2 sphereUV = vec2(		0.5 + atan(hitPoint.z, hitPoint.x) / (2.0 * PI),		0.5 - asin(hitPoint.y) / PI	);	vec3 color = getColor(sphereUV, textureViewBox);	gl_FragColor = vec4(color, alpha);
}`}};var G=class{constructor(e,t,i){this._glVersion=1;this._isForwardLocked=!1;this._ratio={value:1,loc:null};this._zoomFactorLoc=null;this._movementFactor={convergence:new P(0,0,-1,1,T.EASE_IN_OUT,p.TRANSITION_DURATION),loc:null};this._forward={value:[0,0,-1],loc:null};this._texture={texValue:null,texLoc:null,viewBox:[0,0,1,1],viewBoxLoc:null};this._alpha={value:1,loc:null};this._maxTextureLevel={value:0,loc:null};this._isBlurOn={value:!1,loc:null};this._isX360={value:!1,loc:null};this._isY180={value:!1,loc:null};this._isInitialTexture=!0;this._gl=e,this._glVersion=t,this._isTextureLodExtensionAvailable=i,this._vertexShader=e.createShader(e.VERTEX_SHADER),this._fragmentShader=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(this._vertexShader,this.vertexShader),e.shaderSource(this._fragmentShader,this.fragmentShader);try{this.compileShaders(),this.initProgram(),this._ratio.loc=this._gl.getUniformLocation(this._program,"ratio"),this._zoomFactorLoc=this._gl.getUniformLocation(this._program,"zoomFactor"),this._movementFactor.loc=this._gl.getUniformLocation(this._program,"movementFactor"),this._forward.loc=this._gl.getUniformLocation(this._program,"fw"),this._texture.texLoc=this._gl.getUniformLocation(this._program,"texture"),this._texture.viewBoxLoc=this._gl.getUniformLocation(this._program,"textureViewBox"),this._alpha.loc=this._gl.getUniformLocation(this._program,"alpha"),this._maxTextureLevel.loc=this._gl.getUniformLocation(this._program,"maxTextureLevel"),this._isBlurOn.loc=this._gl.getUniformLocation(this._program,"isBlurOn"),this._isX360.loc=this._gl.getUniformLocation(this._program,"isX360"),this._isY180.loc=this._gl.getUniformLocation(this._program,"isY180"),this.initTexture()}catch(r){console.error(r)}}get vertexShader(){let e=se.vertexShader;return this.isWebGL2Supported&&(e=`#version 300 es
${e}`.replace(/varying/g,"out").replace(/attribute/g,"in")),e}get fragmentShader(){let e=se.fragmentShader;return this.isWebGL2Supported&&(e=`#version 300 es
${e}`.replace(/varying/g,"in").replace(/texture2DLodEXT/g,"textureLod").replace(/texture2D/g,"texture").replace(/precision highp float;/,`precision highp float;
out vec4 outputColor;`).replace(/gl_FragColor/g,"outputColor")),e}get isWebGL2Supported(){return this._glVersion>=2}isTexturePOT(e){return v.isPowerOfTwo(e.width)&&v.isPowerOfTwo(e.height)}isBlurAvailable(e){return this.isWebGL2Supported?!0:this._isTextureLodExtensionAvailable&&this.isTexturePOT(e)}compileShaders(){this.compileShader(this._vertexShader),this.compileShader(this._fragmentShader)}compileShader(e){if(this._gl.compileShader(e),!this._gl.getShaderParameter(e,this._gl.COMPILE_STATUS))throw`Error compiling shader: ${this._gl.getShaderInfoLog(e)}`}initProgram(){this._program=this._gl.createProgram(),this._gl.attachShader(this._program,this._vertexShader),this._gl.attachShader(this._program,this._fragmentShader),this.linkProgram(),this.validateProgram()}linkProgram(){if(this._gl.linkProgram(this._program),!this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)&&!this._gl.isContextLost())throw`Error linking program: ${this._gl.getError()}, ${this._gl.getProgramInfoLog(this._program)}`}validateProgram(){if(this._gl.validateProgram(this._program),!this._gl.getProgramParameter(this._program,this._gl.VALIDATE_STATUS))throw`Error validating program: ${this._gl.getProgramInfoLog(this._program)}`}setSize(e,t){this._ratio.value=e/t}initTexture(){this._texture.texValue=this._gl.createTexture();let e=new ImageData(1,1),t=[0,0,1,1];this.loadTexture({textureData:e,viewBox:t,headingAngle:0})}loadTexture(e){let t=this._texture;this._isInitialTexture&&(this._isInitialTexture=!1),t.viewBox=e.viewBox,this._maxTextureLevel.value=Math.log2(Math.max(e.textureData.width,e.textureData.height));let i=t.viewBox[2]-t.viewBox[0]==1,r=t.viewBox[3]-t.viewBox[1]==1;this._isX360.value=i,this._isY180.value=r;let o=!(i&&r)&&this.isBlurAvailable(e.textureData);this._isBlurOn.value=o;let n=this._gl;n.bindTexture(n.TEXTURE_2D,t.texValue),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,o&&i?n.REPEAT:n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o?n.LINEAR_MIPMAP_LINEAR:n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGB,n.RGB,n.UNSIGNED_BYTE,e.textureData),o&&n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null)}fadeIn(){this._movementFactor.convergence.reset(-1,0)}fadeOut(){this._movementFactor.convergence.setEnd(1)}lockForward(){this._isForwardLocked=!0}unlockForward(){this._isForwardLocked=!1}resetZoom(){this._movementFactor.convergence.reset(0,0)}setVec3Uniform(e,t){this._gl.uniform3fv(e,t)}setVec4Uniform(e,t){this._gl.uniform4fv(e,t)}setFloatUniform(e,t){this._gl.uniform1f(e,t)}setBoolUniform(e,t){this._gl.uniform1i(e,t?1:0)}setTextureData(e,t){this._gl.activeTexture(this._gl.TEXTURE0+t),this._gl.bindTexture(this._gl.TEXTURE_2D,e.texValue),this._gl.uniform1i(e.texLoc,t)}setTexture(e,t){this.setVec4Uniform(e.viewBoxLoc,e.viewBox),this.setTextureData(e,t)}updateUniforms(e){this.setFloatUniform(this._ratio.loc,this._ratio.value),this.setVec3Uniform(this._forward.loc,this._forward.value),this.setFloatUniform(this._zoomFactorLoc,e),this.setFloatUniform(this._movementFactor.loc,this._movementFactor.convergence.value),this.setFloatUniform(this._alpha.loc,this._alpha.value),this.setFloatUniform(this._maxTextureLevel.loc,this._maxTextureLevel.value),this.setBoolUniform(this._isBlurOn.loc,this._isBlurOn.value),this.setBoolUniform(this._isX360.loc,this._isX360.value),this.setBoolUniform(this._isY180.loc,this._isY180.value),this.setTexture(this._texture,0)}render(e,t,i){t>0&&(this._isForwardLocked||(this._forward.value=e),this._alpha.value=t,this._gl.useProgram(this._program),this.updateUniforms(i),this._gl.drawArrays(this._gl.TRIANGLE_STRIP,0,4))}get program(){return this._program}static get defaultViewBox(){return[0,0,1,1]}static get defaultTextureData(){return{textureData:new ImageData(1,1),viewBox:this.defaultViewBox,headingAngle:0}}};var me=class{constructor(e,t){this._webGLVersion=2;this._isInitialTexture=!0;this._mixFactor=new P(0,0,0,1,T.EASE_IN_OUT,p.TRANSITION_DURATION);this.onContextLost=e=>{e.preventDefault()};this._canvas=e,this._sceneManager=t}init(){let e={alpha:!1,antialias:!1};this._gl=this._canvas.getContext("webgl2",e)||this._canvas.getContext("experimental-webgl2",e);let t=!1;return this._gl||(this._webGLVersion=1,this._gl=this._canvas.getContext("webgl",e),this._gl&&(t=!!this._gl.getExtension("EXT_shader_texture_lod"))),this._gl?(this._gl.clearColor(.125,.25,.5,1),this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight),this._gl.enable(this._gl.BLEND),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.DST_ALPHA),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._shader0=new G(this._gl,this._webGLVersion,t),this._shader1=new G(this._gl,this._webGLVersion,t),this._canvas.addEventListener("webglcontextlost",this.onContextLost),this.initGeometry(),this._gl.useProgram(this._shader0.program),!0):!1}get maxTextureSize(){var e;return((e=this._gl)==null?void 0:e.getParameter(this._gl.MAX_TEXTURE_SIZE))||1}get isWebGL2Supported(){return this._webGLVersion>=2}setSize(e,t){if(this._gl){let i=window.devicePixelRatio,r=window.innerWidth*i,s=window.innerHeight*i;this._canvas.width=r,this._canvas.height=s,this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight),this._shader0.setSize(e,t),this._shader1.setSize(e,t),this._sceneManager.needsRender=!0}}initAttribPointer(e){this._gl.vertexAttribPointer(e,3,this._gl.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0)}initVertices(e){let t=this._gl.getAttribLocation(e,"vertPosition");this.initAttribPointer(t),this._gl.enableVertexAttribArray(t)}initGeometry(){let e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],t=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.initVertices(this._shader0.program),this.initVertices(this._shader1.program)}loadDefaultTexture(){this.loadTexture(G.defaultTextureData)}loadTexture(e,t=!1){let i=0;this._isInitialTexture?this._isInitialTexture=!1:i=this._mixFactor.end===1?0:1;let r=i===0?this._shader1:this._shader0,s=i===0?this._shader0:this._shader1;r.lockForward(),s.unlockForward(),s.loadTexture(e),t||(r.resetZoom(),s.resetZoom()),requestAnimationFrame(()=>{this._mixFactor.setEnd(i),t&&(r.fadeOut(),s.fadeIn())})}render(e,t){this._shader0.render(e,1-this._mixFactor.value,t),this._shader1.render(e,this._mixFactor.value,t)}};var L=class{static lengthOfSquared(e){let t=0;for(let i of e)t+=i*i;return t}static lengthOf(e){return Math.sqrt(L.lengthOfSquared(e))}static normalize(e){let t=L.lengthOf(e);for(let i=0;i<e.length;++i)e[i]/=t;return e}static subVectors(e,t){let i=[];for(let r=0;r<e.length;++r)i.push(e[r]-t[r]);return i}static crossVectors(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}static multiplyByScalar(e,t){let i=[];for(let r=0;r<e.length;++r)i[r]=e[r]*t;return i}static getSphereSurfacePointFromUV(e,t){let i=[Math.cos(e)*Math.sin(t),Math.cos(t),Math.sin(e)*Math.sin(t)];return L.normalize(i)}static setFromMatrixPosition(e){let t=e.elements;return[t[12],t[13],t[14]]}static distanceBetweenSquared(e,t){let i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}static setQuaternionFromVector3(e){let t=Math.cos,i=Math.sin,r=t(e[0]/2),s=t(e[1]/2),o=t(e[2]/2),n=i(e[0]/2),a=i(e[1]/2),l=i(e[2]/2);return[n*s*o+r*a*l,r*a*o-n*s*l,r*s*l+n*a*o,r*s*o-n*a*l]}static setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],n=t[5],a=t[9],l=t[2],u=t[6],c=t[10],m=i+n+c,h,_,b,g,d;return m>0?(h=.5/Math.sqrt(m+1),_=.25/h,b=(u-a)*h,g=(s-l)*h,d=(o-r)*h):i>n&&i>c?(h=2*Math.sqrt(1+i-n-c),_=(u-a)/h,b=.25*h,g=(r+o)/h,d=(s+l)/h):n>c?(h=2*Math.sqrt(1+n-i-c),_=(s-l)/h,b=(r+o)/h,g=.25*h,d=(a+u)/h):(h=2*Math.sqrt(1+c-i-n),_=(o-r)/h,b=(s+l)/h,g=(a+u)/h,d=.25*h),[b,g,d,_]}setFromMatrixPosition(e){let t=e.elements;return[t[12],t[13],t[14]]}};var F=class{constructor(){this._elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,o,n,a,l,u,c,m,h,_,b,g){let d=this._elements;return d[0]=e,d[4]=t,d[8]=i,d[12]=r,d[1]=s,d[5]=o,d[9]=n,d[13]=a,d[2]=l,d[6]=u,d[10]=c,d[14]=m,d[3]=h,d[7]=_,d[11]=b,d[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(e){let t=this._elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this._elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}transpose(){let e=this._elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}scale(e){let t=this._elements,i=e[0],r=e[1],s=e[2];return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}multiplyMatrices(e,t){let i=e.elements,r=t.elements,s=this._elements,o=i[0],n=i[4],a=i[8],l=i[12],u=i[1],c=i[5],m=i[9],h=i[13],_=i[2],b=i[6],g=i[10],d=i[14],f=i[3],S=i[7],A=i[11],O=i[15],C=r[0],D=r[4],V=r[8],w=r[12],k=r[1],$=r[5],j=r[9],Z=r[13],J=r[2],K=r[6],Q=r[10],ee=r[14],te=r[3],ie=r[7],re=r[11],ne=r[15];return s[0]=o*C+n*k+a*J+l*te,s[4]=o*D+n*$+a*K+l*ie,s[8]=o*V+n*j+a*Q+l*re,s[12]=o*w+n*Z+a*ee+l*ne,s[1]=u*C+c*k+m*J+h*te,s[5]=u*D+c*$+m*K+h*ie,s[9]=u*V+c*j+m*Q+h*re,s[13]=u*w+c*Z+m*ee+h*ne,s[2]=_*C+b*k+g*J+d*te,s[6]=_*D+b*$+g*K+d*ie,s[10]=_*V+b*j+g*Q+d*re,s[14]=_*w+b*Z+g*ee+d*ne,s[3]=f*C+S*k+A*J+O*te,s[7]=f*D+S*$+A*K+O*ie,s[11]=f*V+S*j+A*Q+O*re,s[15]=f*w+S*Z+A*ee+O*ne,this}makePerspective(e,t,i,r,s,o){let n=this._elements,a=2*s/(t-e),l=2*s/(i-r),u=(t+e)/(t-e),c=(i+r)/(i-r),m=-(o+s)/(o-s),h=-2*o*s/(o-s);return n[0]=a,n[4]=0,n[8]=u,n[12]=0,n[1]=0,n[5]=l,n[9]=c,n[13]=0,n[2]=0,n[6]=0,n[10]=m,n[14]=h,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(e,t,i,r,s,o){let n=this.elements,a=1/(t-e),l=1/(i-r),u=1/(o-s),c=(t+e)*a,m=(i+r)*l,h=(o+s)*u;return n[0]=2*a,n[4]=0,n[8]=0,n[12]=-c,n[1]=0,n[5]=2*l,n[9]=0,n[13]=-m,n[2]=0,n[6]=0,n[10]=-2*u,n[14]=-h,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}getInverse(e){let t=this._elements,i=e.elements,r=i[0],s=i[1],o=i[2],n=i[3],a=i[4],l=i[5],u=i[6],c=i[7],m=i[8],h=i[9],_=i[10],b=i[11],g=i[12],d=i[13],f=i[14],S=i[15],A=h*f*c-d*_*c+d*u*b-l*f*b-h*u*S+l*_*S,O=g*_*c-m*f*c-g*u*b+a*f*b+m*u*S-a*_*S,C=m*d*c-g*h*c+g*l*b-a*d*b-m*l*S+a*h*S,D=g*h*u-m*d*u-g*l*_+a*d*_+m*l*f-a*h*f,V=r*A+s*O+o*C+n*D;if(V===0)return console.warn("Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity();let w=1/V;return t[0]=A*w,t[1]=(d*_*n-h*f*n-d*o*b+s*f*b+h*o*S-s*_*S)*w,t[2]=(l*f*n-d*u*n+d*o*c-s*f*c-l*o*S+s*u*S)*w,t[3]=(h*u*n-l*_*n-h*o*c+s*_*c+l*o*b-s*u*b)*w,t[4]=O*w,t[5]=(m*f*n-g*_*n+g*o*b-r*f*b-m*o*S+r*_*S)*w,t[6]=(g*u*n-a*f*n-g*o*c+r*f*c+a*o*S-r*u*S)*w,t[7]=(a*_*n-m*u*n+m*o*c-r*_*c-a*o*b+r*u*b)*w,t[8]=C*w,t[9]=(g*h*n-m*d*n-g*s*b+r*d*b+m*s*S-r*h*S)*w,t[10]=(a*d*n-g*l*n+g*s*c-r*d*c-a*s*S+r*l*S)*w,t[11]=(m*l*n-a*h*n-m*s*c+r*h*c+a*s*b-r*l*b)*w,t[12]=D*w,t[13]=(m*d*o-g*h*o+g*s*_-r*d*_-m*s*f+r*h*f)*w,t[14]=(g*l*o-a*d*o-g*s*u+r*d*u+a*s*f-r*l*f)*w,t[15]=(a*h*o-m*l*o+m*s*u-r*h*u-a*s*_+r*l*_)*w,this}compose(e,t,i){let r=this._elements,s=t[0],o=t[1],n=t[2],a=t[3],l=s+s,u=o+o,c=n+n,m=s*l,h=s*u,_=s*c,b=o*u,g=o*c,d=n*c,f=a*l,S=a*u,A=a*c,O=i[0],C=i[1],D=i[2];return r[0]=(1-(b+d))*O,r[1]=(h+A)*O,r[2]=(_-S)*O,r[3]=0,r[4]=(h-A)*C,r[5]=(1-(m+d))*C,r[6]=(g+f)*C,r[7]=0,r[8]=(_+S)*D,r[9]=(g-f)*D,r[10]=(1-(m+b))*D,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,this}lookAt(e,t,i){let r=this._elements,s=L.subVectors(e,t),o=L.crossVectors(i,s);o=L.normalize(o);let n=L.crossVectors(s,o);return r[0]=o[0],r[4]=n[0],r[8]=s[0],r[1]=o[1],r[5]=n[1],r[9]=s[1],r[2]=o[2],r[6]=n[2],r[10]=s[2],this}get elements(){return this._elements}};var z=class{constructor(){this._parent=null;this._children=[];this._position=[0,0,0];this._quaternion=[0,0,0,1];this._scale=[1,1,1];this._matrix=new F;this._matrixWorldNeedsUpdate=!0;this._matrixWorld=new F;this._target=[0,0,-1];this._up=[0,1,0];this._m1=new F}setPosition(e,t=!0){this._position=e,t&&(this.updateMatrix(),this.updateMatrixWorld())}setScale(e,t=!0){this._scale=e,t&&(this.updateMatrix(),this.updateMatrixWorld())}updateMatrix(){this._matrix.compose(this._position,this._quaternion,this.scale),this._matrixWorldNeedsUpdate=!0}updateMatrixWorld(e=!0){(this.matrixWorldNeedsUpdate||e)&&(this._parent===null?this.matrixWorld.copy(this._matrix):this.matrixWorld.multiplyMatrices(this._parent.matrixWorld,this._matrix),this._matrixWorldNeedsUpdate=!1,e=!0);for(let t of this._children)t.updateMatrixWorld(e)}updateWorldMatrix(e,t){let i=this._parent;if(e&&i!==null&&i.updateWorldMatrix(!0,!1),this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this._matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this._matrix),t)for(let r of this.children)r.updateWorldMatrix(!1,!0)}add(e){return e._parent!==null&&e._parent.remove(e),e._parent=this,this.children.push(e),this}remove(e){let t=this.children.indexOf(e);return t!==-1&&(e._parent=null,this.children.splice(t,1)),this}traverse(e){e(this);for(let t of this._children)t.traverse(e)}lookAt(e){this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2],this.updateWorldMatrix(!0,!1),this._position=L.setFromMatrixPosition(this._matrixWorld),this._m1.lookAt(this._position,this._target,this._up),this._quaternion=L.setFromRotationMatrix(this._m1)}get matrixWorldNeedsUpdate(){return this._matrixWorldNeedsUpdate}get children(){return this._children}get parent(){return this._parent}get scale(){return this._scale}get matrixWorld(){return this._matrixWorld}};var X=class extends z{constructor(){super();this._matrixWorldInverse=new F;this._projectionMatrix=new F;this._projectionMatrixInverse=new F}updateMatrixWorld(e=!0){super.updateMatrixWorld(e),this._matrixWorldInverse.getInverse(this._matrixWorld)}get matrixWorldInverse(){return this._matrixWorldInverse}get projectionMatrix(){return this._projectionMatrix}get projectionMatrixInverse(){return this._projectionMatrixInverse}};var q=class extends X{constructor(e,t,i,r,s=1){super();this._fov=e,this._aspect=t,this._near=i,this._far=r,this._zoom=s,this.updateProjectionMatrix()}setZoom(e){this._zoom=e}setAspect(e){this._aspect=e}updateProjectionMatrix(){let e=this._near,t=e*Math.tan(v.deg2rad(.5*this._fov))/this._zoom,i=2*t,r=this._aspect*i,s=-.5*r;this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this._far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}};var oe=class extends X{constructor(e,t,i,r,s,o){super();this._right=0;this._left=0;this._top=0;this._bottom=0;this._near=0;this._far=2;this._zoom=1;this._left=e,this._right=t,this._top=i,this._bottom=r,this._near=s,this._far=o}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this._zoom),t=(this.top-this.bottom)/(2*this._zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=i-e,o=i+e,n=r+t,a=r-t;this._projectionMatrix.makeOrthographic(s,o,n,a,this._near,this._far),this._projectionMatrixInverse.getInverse(this.projectionMatrix)}get right(){return this._right}get left(){return this._left}get top(){return this._top}get bottom(){return this._bottom}};var ae=class extends z{constructor(e){super();this._element=e,this._element.style.position="absolute",this._element.style.pointerEvents="auto"}get element(){return this._element}},le=class extends ae{constructor(e){super(e)}setOriginalPosition(e){this._originalPosition=e}get originalPosition(){return this._originalPosition}},pe=class{constructor(){this._calc1=[];this._calc2=[];this._isIE=/Trident/i.test(navigator.userAgent);this.getDistanceToSquared=(e,t)=>(this._calc1=L.setFromMatrixPosition(e.matrixWorld),this._calc2=L.setFromMatrixPosition(t.matrixWorld),L.distanceBetweenSquared(this._calc1,this._calc2));this._matrix=new F,this._cache={camera:{fov:0,style:""},objects:new WeakMap},this._domElement=document.createElement("div"),this._domElement.style.overflow="hidden",this._cameraElement=document.createElement("div"),this._cameraElement.style.transformStyle="preserve-3d",this._cameraElement.style.pointerEvents="none",this._domElement.appendChild(this._cameraElement)}get domElement(){return this._domElement}getSize(){return{width:this._width,height:this._height}}setSize(e,t){this._width=e,this._height=t,this._widthHalf=e/2,this._heightHalf=t/2,this._domElement.style.width=`${e}px`,this._domElement.style.height=`${t}px`,this._cameraElement.style.width=`${e}px`,this._cameraElement.style.height=`${t}px`}epsilon(e){return Math.abs(e)<1e-10?0:e}getCameraCSSMatrix(e){let t=e.elements;return`matrix3d(
			${this.epsilon(t[0])},
			${this.epsilon(-t[1])},
			${this.epsilon(t[2])},
			${this.epsilon(t[3])},
			${this.epsilon(t[4])},
			${this.epsilon(-t[5])},
			${this.epsilon(t[6])},
			${this.epsilon(t[7])},
			${this.epsilon(t[8])},
			${this.epsilon(-t[9])},
			${this.epsilon(t[10])},
			${this.epsilon(t[11])},
			${this.epsilon(t[12])},
			${this.epsilon(-t[13])},
			${this.epsilon(t[14])},
			${this.epsilon(t[15])}
		)`}getObjectCSSMatrix(e,t){let i=e.elements,r=`matrix3d(
			${this.epsilon(i[0])},
			${this.epsilon(i[1])},
			${this.epsilon(i[2])},
			${this.epsilon(i[3])},
			${this.epsilon(-i[4])},
			${this.epsilon(-i[5])},
			${this.epsilon(-i[6])},
			${this.epsilon(-i[7])},
			${this.epsilon(i[8])},
			${this.epsilon(i[9])},
			${this.epsilon(i[10])},
			${this.epsilon(i[11])},
			${this.epsilon(i[12])},
			${this.epsilon(i[13])},
			${this.epsilon(i[14])},
			${this.epsilon(i[15])}
		)`;return this._isIE?`translate(-50%,-50%) translate(${this._widthHalf}px, ${this._heightHalf}px) ${t} ${r}`:`translate(-50%,-50%) ${r}`}renderObject(e,t,i){if(e instanceof ae){let r;e instanceof le?(this._matrix.copy(t.matrixWorldInverse),this._matrix.transpose(),this._matrix.copyPosition(e.matrixWorld),this._matrix.scale(e.scale),this._matrix.elements[3]=0,this._matrix.elements[7]=0,this._matrix.elements[11]=0,this._matrix.elements[15]=1,r=this.getObjectCSSMatrix(this._matrix,i)):r=this.getObjectCSSMatrix(e.matrixWorld,i);let s=e.element,o=this._cache.objects.get(e);if(o===void 0||o.style!==r){s.style.transform=r;let n={style:r,distanceToCameraSquared:null};this._isIE&&(n.distanceToCameraSquared=this.getDistanceToSquared(t,e)),this._cache.objects.set(e,n)}s.parentNode!==this._cameraElement&&this._cameraElement.appendChild(s)}for(let r of e.children)this.renderObject(r,t,i)}filterAndFlatten(e){let t=[];return e.traverse(i=>{i instanceof ae&&t.push(i)}),t}zOrder(e){let t=this.filterAndFlatten(e).sort((r,s)=>{let o=this._cache.objects.get(r).distanceToCameraSquared,n=this._cache.objects.get(s).distanceToCameraSquared;return o-n}),i=t.length;for(let r=0;r<t.length;++r)t[r].element.style.zIndex=(i-r).toString()}render(e,t){let i=t.projectionMatrix.elements[5]*this._heightHalf;this._cache.camera.fov!==i&&(t instanceof q?this._domElement.style.perspective=`${i}px`:this._domElement.style.perspective="",this._cache.camera.fov=i),e.updateMatrixWorld(),t.parent===null&&t.updateMatrixWorld(!1);let r=0,s=0;t instanceof oe&&(r=-(t.right+t.left)/2,s=(t.top+t.bottom)/2);let o=t instanceof oe?`scale(${i})translate(${this.epsilon(r)}px,${this.epsilon(s)}px)${this.getCameraCSSMatrix(t.matrixWorldInverse)}`:`translateZ(${i}px)${this.getCameraCSSMatrix(t.matrixWorldInverse)}`,n=o+`translate(${this._widthHalf}px, ${this._heightHalf}px)`;this._cache.camera.style!==n&&!this._isIE&&(this._cameraElement.style.transform=n,this._cache.camera.style=n),this.renderObject(e,t,o),this._isIE&&this.zOrder(e)}};var de=class extends z{constructor(){super();this.type="Scene"}};var he=class{constructor(e,t){this._renderer=new pe;this._scene=new de;this._userZoomFactor=1;this._scaleFactor=new P(1,1,p.MIN_ZOOM_FACTOR/p.DEFAULT_ZOOM_FACTOR,p.DEFAULT_ZOOM_FACTOR,T.EASE_IN_OUT,p.TRANSITION_DURATION);this._camera=new q(p.FOV,1,.5,2,1);this._isForwardLocked=!1;this._hotSpots=[];this._sceneManager=t,this._renderer.domElement.style.position="absolute",this._renderer.domElement.style.top="0",this._renderer.domElement.style.left="0",e.parentElement.appendChild(this._renderer.domElement)}clearScene(){for(let e of this._hotSpots)e.destroy();this._hotSpots.length=0,this._scene.children.length=0}fade(){this._renderer.domElement.style.zIndex="0",this._isForwardLocked=!0;let e=this._scaleFactor.end;this._scaleFactor.reset(p.MIN_ZOOM_FACTOR,p.DEFAULT_ZOOM_FACTOR),this.addClassNameToHotSpots("invisible"),setTimeout(()=>{this.clearScene(),this._scaleFactor.reset(e,e)},p.TRANSITION_DURATION)}createHotSpot(e,t){this.makeHotSpot(e,t),this.resizeHotSpots(),this._sceneManager.needsRender=!0}makeHotSpot(e,t){let i=e.createObject3D();e.signals.click.add(()=>{let s=this.photoSpheres[e.photoSphere.index].transitions.find(o=>o.toPanoramaId===this._sceneManager.photoSphereID);t(e.photoSphere.index,s?s.longitude+Math.PI:null,!0)}),this._hotSpots.push(e),this._scene.add(i)}updateHotSpots(e,t,i=!1){this._isForwardLocked=!1,this._renderer.domElement.style.zIndex="1";for(let r of e)this.makeHotSpot(r,t);i&&this.playMovementEffect(),this.addClassNameToHotSpots("invisible"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.removeClassNameFromHotSpots("invisible")})}),this.resizeHotSpots()}resizeHotSpots(e=1){for(let t of this._hotSpots)t.resize(e)}setSize(e,t){this._renderer.setSize(e,t),this._camera.setAspect(e/t),this._camera.updateProjectionMatrix(),this.resizeHotSpots()}addClassNameToHotSpots(e){for(let t of this._htmlElements)t.classList.add(e)}removeClassNameFromHotSpots(e){for(let t of this._htmlElements)t.classList.remove(e)}playMovementEffect(){this._scaleFactor.reset(this._scaleFactor.min,p.MIN_ZOOM_FACTOR)}render(e,t){let i=this._userZoomFactor!==t;(!this._isForwardLocked||this._forward==null)&&(this._forward=e,this._userZoomFactor=t),i&&(this._camera.setZoom(this._userZoomFactor),this._camera.updateProjectionMatrix()),(this._scaleFactor.hasChangedSinceLastTick||i)&&this.resizeHotSpots(this._scaleFactor.value),this._camera.lookAt(this._forward),this._camera.updateMatrix(),this._camera.updateMatrixWorld(),this._renderer.render(this._scene,this._camera)}get _htmlElements(){return this._hotSpots.map(e=>e.element)}};var W=class{static addToClassList(e,t){for(let i=0;i<e.length;++i)e[i].classList.add(t)}static removeFromClassList(e,t){for(let i=0;i<e.length;++i)e[i].classList.remove(t)}static addListenerToHTMLElements(e,t,i){for(let r=0;r<e.length;++r)e[r].addEventListener(t,i)}static removeListenerFromHTMLElements(e,t,i){for(let r=0;r<e.length;++r)e[r].removeEventListener(t,i)}static addStyleToHTMLElements(e,t,i){for(let r=0;r<e.length;++r)e[r].style[t]=i}static removeElementFromDom(e){e.parentElement&&e.parentElement.removeChild(e)}static clearElement(e){for(;e.firstChild;)e.removeChild(e.firstChild)}static hideElement(e){e.style.display="none"}static showElement(e,t=!1){e.style.display=t?"block":""}static isElementChildOfElement(e,t){return t.contains(e)}static disableElement(e){e.classList.add("disabledPointerActions")}static enableElement(e){e.classList.remove("disabledPointerActions")}};var Y=class{static intersectSphere(e,t,i,r){let s=Y.convertCameraPositionAndCursorToRay(e,t,i,r),o=s.origin,n=x.dotProduct(o,o)-1,a=x.dotProduct(s.direction,o),l=a*a-n,u=-a+Math.sqrt(Math.abs(l));return x.addVectors(s.origin,x.multiplyByScalar(s.direction,u))}static convertCameraPositionAndCursorToRay(e,t,i,r){let s=p.WORLD_UP,o=x.normalize(x.crossVectors(e,s)),n=x.normalize(x.crossVectors(o,e)),a=x.multiplyByScalar(e,v.getForwardLengthFromFOV(p.FOV)*r),l=x.multiplyByScalar(x.multiplyByScalar(o,i),t[0]),u=x.multiplyByScalar(n,t[1]),c=x.addVectors(x.addVectors(a,l),u);return{origin:p.CAMERA_POSITION,direction:x.normalize(c)}}};var _e=class{constructor(e,t,i){this._desktopScale=.0011;this._mobileScale=this._desktopScale*1.35;this._timeoutId=-1;this._animationFrameId=-1;this.signals={click:y.create()};this.showThumbnail=()=>{clearTimeout(this._timeoutId),cancelAnimationFrame(this._animationFrameId),this._thumbnail.style.display="block",this._animationFrameId=window.requestAnimationFrame(()=>{this._thumbnail.style.opacity="1"})};this.hideThumbnail=()=>{clearTimeout(this._timeoutId),cancelAnimationFrame(this._animationFrameId),requestAnimationFrame(()=>{this._thumbnail.style.opacity=""}),this._timeoutId=window.setTimeout(()=>{this._thumbnail.style.display=""},300)};this.onMouseDown=e=>{e.button===p.MOUSE_BUTTON.LEFT&&this.onPointerDown(e.clientX,e.clientY,e)};this.onTouchStart=e=>{e.preventDefault(),e.touches.length===1?this.onPointerDown(e.touches[0].clientX,e.touches[0].clientY,e):this.onPointerUp()};this.onMouseMove=e=>{this.onPointerMove(e.clientX,e.clientY,e)};this.onTouchMove=e=>{e.preventDefault(),e.touches.length===1?this.onPointerMove(e.touches[0].clientX,e.touches[0].clientY,e):this.onPointerUp()};this.onPointerUp=()=>{this._pointer&&(performance.now()-this._pointer.downTimeStamp>p.clickThreshold.time&&(this._pointer.triggerClickOnPointerUp=!1),this._pointer.triggerClickOnPointerUp&&this.signals.click.dispatch(null)),this._pointer=null};this._id=t.id,this._longitude=t.longitude,this._latitude=t.latitude,this._photoSphere=e,this._sceneManager=i}createObject3D(){this._element=document.createElement("div"),this._element.className="hotSpot",this._thumbnail=document.createElement("img"),this._thumbnail.src=this._photoSphere.preview,this._thumbnail.classList.add("thumbnail"),this._element.appendChild(this._thumbnail),this._labelContainer=document.createElement("div"),this._labelContainer.classList.add("vbox"),this._labelContainer.classList.add("labelContainer");let e=document.createElement("div");e.classList.add("icon"),this._labelContainer.appendChild(e),this._photoSphere.name&&(this._label=document.createElement("div"),this._label.textContent=this._photoSphere.name,this._label.classList.add("label"),this._labelContainer.appendChild(this._label)),this._labelContainer.addEventListener("mousemove",this.showThumbnail),this._labelContainer.addEventListener("mouseleave",this.hideThumbnail),this._element.appendChild(this._labelContainer),this._labelContainer.addEventListener("mousedown",this.onMouseDown),this._labelContainer.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("mouseup",this.onPointerUp),window.addEventListener("touchend",this.onPointerUp),window.addEventListener("touchcancel",this.onPointerUp);let t=v.getSphereSurfacePointFromUV(this._longitude,Math.PI/2-this._latitude);return this._object3D=new le(this._element),this._object3D.setOriginalPosition(t),this._object3D}getUVFromClientXY(e,t){let i=[window.innerWidth,window.innerHeight],r=v.getNormalizedCursorCoords(e,t,i),s=this._sceneManager.forward,o=Y.intersectSphere(s,r,i[0]/i[1],this._sceneManager.userZoomFactor.value);return v.getUVFromSphereSufracePoint(o)}onPointerDown(e,t,i){if(i.preventDefault(),!this._pointer){let r=this.getUVFromClientXY(e,t),s=v.getSphereSurfacePointFromUV((r[0]+.5)*2*Math.PI,(1-r[1])*Math.PI);this._pointer={startX:e,startY:t,clientX:e,clientY:t,hasHotSpotMoved:!1,startCursorToObject:x.subVectors(this._object3D.originalPosition,s),triggerClickOnPointerUp:!0,downTimeStamp:performance.now()}}}onPointerMove(e,t,i){if(this._pointer){this._pointer.clientX=e,this._pointer.clientY=t;let r=this._pointer.startX-e,s=this._pointer.startY-t;(p.clickThreshold.movement<Math.abs(r)||p.clickThreshold.movement<Math.abs(s))&&(this._pointer.triggerClickOnPointerUp=!1)}}resize(e=1){let t=window.innerWidth<1e3,i=e*(t?this._mobileScale:this._desktopScale),r=x.multiplyByScalar(this._object3D.originalPosition,1/i);this._object3D.setPosition(r)}destroy(){this._element&&(this.signals.click.removeAll(),this._object3D.parent&&this._object3D.parent.remove(this._object3D),this._labelContainer.removeEventListener("mousemove",this.showThumbnail),this._labelContainer.removeEventListener("mouseleave",this.hideThumbnail),this._labelContainer.removeEventListener("mousedown",this.onMouseDown),this._labelContainer.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onPointerUp),window.removeEventListener("touchend",this.onPointerUp),window.removeEventListener("touchcancel",this.onPointerUp),W.removeElementFromDom(this._element))}get element(){return this._element}get photoSphere(){return this._photoSphere}get longitude(){return this._longitude}get latitude(){return this._latitude}};var U=class{constructor(){this._activeCss3DManagerIndex=1;this._forward=[0,0,-1];this._userZoomFactor=new P(p.DEFAULT_ZOOM_FACTOR,p.DEFAULT_ZOOM_FACTOR,p.MIN_ZOOM_FACTOR,4,T.EASE_OUT,p.TRANSITION_DURATION);this._isFirstTextureLoaded=!1;this.signals={resize:y.create(),tick:y.create(),webglNotSupported:y.create()};this.needsRender=!0;this.onContextLost=()=>{this.signals.webglNotSupported.dispatch("contextLost")};this.onWindowResize=()=>{let e=window.innerWidth,t=window.innerHeight;this._webGLRenderer.setSize(e,t),this._css3dManagers[0].setSize(e,t),this._css3dManagers[1].setSize(e,t),this._controls.setSize(),this.signals.resize.dispatch({width:e,height:t})};this.update=()=>{this._isFirstTextureLoaded&&(U._timeStamp=performance.now(),U._deltaFrame=U._timeStamp-U.prevTimeStamp,U.prevTimeStamp=U._timeStamp,N.updateActiveOnes(U._timeStamp)&&(this._forward=this._controls.update(),this.needsRender=!0),this.needsRender&&(this._webGLRenderer.render(this._forward,this._userZoomFactor.value),this._css3dManagers[0].render(this._forward,this._userZoomFactor.value),this._css3dManagers[1].render(this._forward,this._userZoomFactor.value),this.needsRender=!1),this.signals.tick.dispatch(null))};this.animate=()=>{this.update(),requestAnimationFrame(this.animate)};this._canvas=document.getElementById("myCanvas")}init(){try{this.initRenderers(),this.initControls(),window.addEventListener("resize",this.onWindowResize),this.onWindowResize()}catch(e){return!1}return!0}initRenderers(){this._webGLRenderer=new me(this._canvas,this),this._webGLRenderer.init(),this._canvas.addEventListener("webglcontextlost",this.onContextLost),this._css3dManagers=[new he(this._canvas,this),new he(this._canvas,this)]}initControls(){this._controls=new ue(this._canvas.parentElement,this),this._controls.activate()}loadPhotoSphere(e,t,i,r,s,o){this._photoSphereID=e,this._controls.limitRotation(t.viewBox),this._isFirstTextureLoaded&&this._controls.setHeadingAngle(isNaN(s)?t.headingAngle:s,i,this._isFirstTextureLoaded);let n=Math.max(p.MIN_ZOOM_FACTOR,t.textureData.width*(1.7/4e3)/(t.viewBox[2]-t.viewBox[0]));n<this._userZoomFactor.value&&(i=!1),this._webGLRenderer.loadTexture(t,i),requestAnimationFrame(()=>{this._userZoomFactor.setEnd(Math.min(this._userZoomFactor.end,n)),setTimeout(()=>{this._userZoomFactor.setMax(n)},this._userZoomFactor.animationDuration)});let a=this._activeCss3DManagerIndex;this._activeCss3DManagerIndex=this._activeCss3DManagerIndex===1?0:1,this._css3dManagers[a].fade(),this._css3dManagers[this._activeCss3DManagerIndex].updateHotSpots(r.map(l=>new _e(l.photoSphere,l,this)),o,i),this.needsRender=!0,this._isFirstTextureLoaded=!0}static get timeStamp(){return U._timeStamp}static get deltaFrame(){return U._deltaFrame}get userZoomFactor(){return this._userZoomFactor}get maxTextureSize(){return this._webGLRenderer.maxTextureSize}get isWebGL2Supported(){return this._webGLRenderer.isWebGL2Supported}get css3dManagers(){return this._css3dManagers}get photoSphereID(){return this._photoSphereID}get forward(){return this._forward}},I=U;I.prevTimeStamp=0,I._timeStamp=0,I._deltaFrame=1e3;var ge=class{constructor(){}};var E=class{static createWorker(e){return new Worker(URL.createObjectURL(new Blob([`(${e})()`])))}static getImage(e,t,i){return typeof createImageBitmap!="undefined"?new Promise((r,s)=>{function o(n){n.data.src===e&&(E.worker.removeEventListener("message",o),n.data.error&&s(n.data.error),r(n.data.bitmap))}E.worker.addEventListener("message",o),E.worker.postMessage({url:e,maxTextureSize:t,isWebGL2Supported:i})}):new Promise(async(r,s)=>{let o=await E.getImageElement(e),n=Math.max(o.width,o.height);if(t<n){let l=Math.min(n,t),u=o.width/o.height,c={width:null,height:null};u>=1?(c.width=l,c.height=c.width/u):(c.height=l,c.width=c.width*u),i||v.isPowerOfTwo(Math.max(c.width,c.height))&&(c.height<c.width?c.height=v.ceilPowerOfTwo(c.height):c.width<c.height&&(c.width=v.ceilPowerOfTwo(c.width))),E._canvas.width=c.width,E._canvas.height=c.height,E._ctx.drawImage(o,0,0,c.width,c.height),E._canvas.toBlob(async m=>{let h=await E.getImageElement(URL.createObjectURL(m));r(h)})}else r(o)})}static getImageElement(e){return E._cache[e]||(E._cache[e]=new Promise((t,i)=>{let r=document.createElement("img");r.setAttribute("crossorigin","anonymous"),r.onload=()=>{t(r)},r.onerror=()=>{i(r)},r.src=e})),E._cache[e]}static getNewImageElement(e){return new Promise((t,i)=>{let r=document.createElement("img");r.setAttribute("crossorigin","anonymous"),r.onload=()=>{t(r)},r.onerror=()=>{i(r)},r.src=e})}static async getImageForTexture(e,t,i,r,s){return{textureData:await E.getImage(e,r,s),viewBox:i,headingAngle:t}}},B=E;B._canvas=document.createElement("canvas"),B._ctx=E._canvas.getContext("2d"),B._cache={},B.worker=E.createWorker(()=>{self.addEventListener("message",e=>{let t=e.data.url,i=e.data.maxTextureSize,r=e.data.isWebGL2Supported;fetch(`https://soadzoor.github.io/virtual-tour_deploy/${t}`).then(s=>{s.blob().then(o=>{createImageBitmap(o).then(n=>{let a=Math.max(n.width,n.height);if(i<a){let u=Math.min(a,i),c=n.width/n.height,m={width:null,height:null};if(c>=1?(m.width=u,m.height=m.width/c):(m.height=u,m.width=m.height*c),!r){let _=b=>Math.pow(2,Math.ceil(Math.log(b)/Math.LN2));m.width=_(m.width),m.height=_(m.height)}if(!r){let _=g=>(g&g-1)==0&&g!==0,b=g=>Math.pow(2,Math.ceil(Math.log(g)/Math.LN2));_(Math.max(m.width,m.height))&&(m.height<m.width?m.height=b(m.height):m.width<m.height&&(m.width=v.ceilPowerOfTwo(m.width)))}createImageBitmap(n,0,0,n.width,n.height,{resizeWidth:m.width,resizeHeight:m.height}).then(_=>{self.postMessage({src:t,bitmap:_},[_])})}else self.postMessage({src:t,bitmap:n},[n])})})})})});var be=class{static async loadJSON(e){return await(await fetch(e)).json()}};var ve=class{constructor(e,t){this._imgCache={};this._urlParams=new URLSearchParams(window.location.search);this._numberOfPreloadedImages=5;this._isWebGLSupported=!0;this.loadPhotoSphere=(e,t,i=!1,r=!0)=>new Promise((s,o)=>{if(this._loadedPhotoSphereIndex!==e){this._loadedPhotoSphereIndex=e,W.removeFromClassList(this._container.children,"active"),this._container.children[e].classList.add("active");let n=this._photoSpheres[e],a=n.file;requestAnimationFrame(async()=>{r&&(this._loadingPage.classList.remove("hidden"),this._loadingPage.classList.remove("invisible"));let l=I.timeStamp,u=await this.loadImage(a,n.headingAngle,n.viewBox),c=performance.now();clearTimeout(this._timeoutID),r&&(this._loadingPage.classList.add("invisible"),c-l<1e3?this._loadingPage.classList.add("hidden"):this._timeoutID=setTimeout(()=>{this._loadingPage.classList.add("hidden")},1e3));let m=this._photoSpheres[e].transitions.map((f,S)=>({photoSphere:this.getPhotoSphereFromID(f.toPanoramaId),latitude:f.latitude,longitude:f.longitude}));this._sceneManager.loadPhotoSphere(this._photoSpheres[e].id,u,i,m,t,this.loadPhotoSphere);let h=this._container.children[this._loadedPhotoSphereIndex],_=this._container.firstChild.scrollLeft,b=h.offsetLeft,g=window.innerWidth/2-h.offsetWidth/2,d=b+_-g;requestAnimationFrame(()=>{this._userInterface.scrollTo(d),s(!0)})})}});this._sceneManager=e,this._userInterface=t,this._container=document.getElementById("imageList"),this._progressBar=document.getElementById("progressBar"),this._loadingPage=document.getElementById("loadingPage"),this._loadingBG=document.getElementById("loadingBG"),this._errorPage=document.getElementById("errorPage"),this._startTourPage=document.getElementById("startTourPage")}async preInit(){this.maxTextureSize?await this.init():this._isWebGLSupported=!1}async init(){let e=this._urlParams.get("play")==="0";e||this._loadingPage.classList.remove("hidden"),await this.initBG()&&(e?(this._startTourPage.classList.remove("hidden"),this._startTourPage.onclick=()=>{this.initPhotoSpheres()}):this.initPhotoSpheres())}initBG(){return new Promise(async(e,t)=>{let i="assets/config.json",r=await be.loadJSON(i);r?(this._loadingBG.style.backgroundImage=`url(${r.preview})`,this._loadingBGTimeStamp=performance.now(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this._loadingBG.classList.remove("invisible"),this._photoSpheres=r.panoramas,this._sceneManager.css3dManagers[0].photoSpheres=this._photoSpheres,this._sceneManager.css3dManagers[1].photoSpheres=this._photoSpheres,console.log(this._photoSpheres),e(!0)})})):(this.showErrorPage("notfound"),e(!1))})}async initPhotoSpheres(){this._startTourPage.classList.add("hidden"),this._loadingPage.classList.remove("hidden"),await this.initThumbnails(),await this.preloadImages(0,this._numberOfPreloadedImages,!0),await this.loadPhotoSphere(0,void 0,void 0,!1);let t=performance.now()-this._loadingBGTimeStamp;setTimeout(()=>{requestAnimationFrame(()=>{this._loadingPage.classList.add("invisible"),this._loadingBG.classList.add("invisible"),setTimeout(async()=>{this._loadingPage.classList.add("hidden"),this._loadingPage.style.backgroundColor="rgba(25, 25, 25, .4)",this._progressBar.style.width="",this._progressBar.classList.add("cycle"),W.removeElementFromDom(this._loadingBG),await this.preloadImages(this._numberOfPreloadedImages,this._photoSpheres.length-this._numberOfPreloadedImages)},1e3),document.getElementById("scene").classList.remove("invisible")})},Math.max(1e3-t,0))}showErrorPage(e,t){this._loadingPage.classList.add("hidden");let i=this._errorPage.querySelector(".vbox");if(e==="notfound")i.innerHTML="<h2>Tour not found</h2>";else if(e==="unavailable")i.innerHTML=`<h2>Temporarily unavailable</h2>
				<p>Please try again later</p>
				<div id="reload" onclick="location.reload(true);" class="btn bigBtn flexCenter">RELOAD</div>`;else if(e==="unsupportedBrowser"){let r=t==="contextLost"?`<h2>App has stopped</h2>
				<div onclick="location.reload(true);" class="btn bigBtn flexCenter">RELOAD</div>`:`<h2>Sorry, your browser isn't supported</h2>
				<p>Please update it, or try another one.</p>`;i.innerHTML=r}this._errorPage.classList.remove("hidden")}async initThumbnails(){for(let e=0;e<this._photoSpheres.length;++e){let t=this._photoSpheres[e],i=t.preview,r=document.createElement("div");r.className="photoSphere btn",r.setAttribute("data-label",t.name);let s=await B.getNewImageElement(i);r.appendChild(s),r.onmousedown=r.ontouchstart=o=>{let n={x:o.clientX||o.touches[0].clientX,y:o.clientY||o.touches[0].clientY};r.pointerDown=n},r.onmouseup=r.ontouchend=async o=>{let n=r.pointerDown;if(n){r.pointerDown=null;let a={x:o.clientX||o.changedTouches[0].clientX,y:o.clientY||o.changedTouches[0].clientY},l=3;Math.abs(a.x-n.x)<l&&Math.abs(a.y-n.y)<l&&await this.loadPhotoSphere(e)}},this._container.appendChild(r)}}async loadImage(e,t,i){try{return this._imgCache[e]||(this._imgCache[e]=B.getImageForTexture(e,t,i,this.maxTextureSize,this.isWebGL2Supported)),await this._imgCache[e]}catch(r){this.showErrorPage("unavailable")}}async preloadImages(e,t,i=!1){let r=[],s=Math.min(e+t,this._photoSpheres.length);e===0&&(this._progressBar.style.width="0%");for(let o=e;o<s;++o){let n=this._photoSpheres[o];n.index=o;let a=n.file;r.push(await this.loadImage(a,n.headingAngle,n.viewBox)),i&&(this._progressBar.style.width=`${(o+1)/s*100}%`)}return r}getPhotoSphereIndexFromID(e){for(let t=0;t<this._photoSpheres.length;++t)if(this._photoSpheres[t].id===e)return t;return-1}getPhotoSphereFromID(e){let t=this.getPhotoSphereIndexFromID(e);return t>-1?this._photoSpheres[t]:null}get container(){return this._container}get maxTextureSize(){return this._sceneManager.maxTextureSize}get isWebGL2Supported(){return this._sceneManager.isWebGL2Supported}get isWebGLSupported(){return this._isWebGLSupported}};var fe=class{constructor(e,t,i){this.onBrowserNotSupported=e=>{this._imageList.showErrorPage("unsupportedBrowser",e)};this.setSize=()=>{var e;(e=this._scrollLeft)==null||e.setMax(this.getMaxScrollLeft())};this.onTick=()=>{this._scrollLeft&&(this._imageList.container.scrollLeft=this._scrollLeft.value)};this.toggleFullscreen=()=>{let e=document;if(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)(e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen).call(document);else{let r=document.body;r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.msRequestFullscreen&&r.msRequestFullscreen()}this._fullScreenToggler.classList.toggle("active");let i=this._fullScreenToggler.classList.contains("active")?"Exit":"Enter";this._fullScreenToggler.title=`${i} Fullscreen`};this._sceneManager=e,this._main=t,this._imageListToggler=document.getElementById("imageListToggler"),this._fullScreenToggler=document.getElementById("fullscreenToggler"),this._menu=document.getElementById("menu"),this.preInit(i)}async preInit(e){e?(this._imageList=new ve(this._sceneManager,this),await this._imageList.preInit(),this._imageList.isWebGLSupported?(this.init(),this._main.signals.ready.dispatch(null)):this.onBrowserNotSupported()):this.onBrowserNotSupported()}getBrowser(){if((navigator.userAgent.indexOf("Opera")||navigator.userAgent.indexOf("OPR"))!=-1)return"Opera";if(navigator.userAgent.indexOf("Chrome")!=-1)return navigator.platform.indexOf("Mac")>-1?"Chrome - Mac":"Chrome";if(navigator.userAgent.indexOf("Safari")!=-1)return"Safari";if(navigator.userAgent.indexOf("Firefox")!=-1)return"Firefox";if(navigator.userAgent.indexOf("MSIE")!=-1||!!document.documentMode)return"IE"}getMaxScrollLeft(){return this._imageList.container.scrollWidth-this._imageList.container.clientWidth}scrollTo(e){this.createScrollLeftIfNeeded(),this._scrollLeft.setEnd(e,!1)}createScrollLeftIfNeeded(){this._scrollLeft||(this._scrollLeft=new P(this._imageList.container.scrollLeft,this._imageList.container.scrollLeft,0,this.getMaxScrollLeft(),T.EASE_OUT,p.TRANSITION_DURATION,!1))}init(){window.oncontextmenu=t=>(t.preventDefault(),!1),this._sceneManager.signals.webglNotSupported.add(this.onBrowserNotSupported),this._sceneManager.signals.resize.add(this.setSize),this._sceneManager.signals.tick.add(this.onTick),p.isFullscreenAvailable?this._fullScreenToggler.addEventListener("click",this.toggleFullscreen):this._fullScreenToggler.classList.add("hidden"),this._imageListToggler.addEventListener("click",()=>{this._imageListToggler.classList.toggle("up"),this._menu.classList.toggle("closed");let t=this._imageListToggler.classList.contains("up")?"Open":"Close";this._imageListToggler.title=`${t} Menu`});let e=this.getBrowser();this._imageList.container.addEventListener("wheel",t=>{t.preventDefault(),this.createScrollLeftIfNeeded();let i=Math.abs(t.deltaX),r=Math.abs(t.deltaY),s=i>0,o=s?i:r,n=s?t.deltaX:t.deltaY,a=s;switch(e){case"Safari":case"Chrome - Mac":a=a||n%1==0&&o<100&&o%120!=0;break;case"Chrome":a=a||o%100!=0&&o%120!=0;break;case"Firefox":a=a||n%1!=0;break}console.log(a);let l=a?o:75;this._scrollLeft.increaseEndBy(Math.sign(n)*l,!0)}),this._imageList.container.addEventListener("touchstart",t=>{var i;((i=this._scrollLeft)==null?void 0:i.isPlaying())||(this._scrollLeft=null)})}};var H=class{constructor(){this.signals={ready:y.create()};this.startAnimating=()=>{this._sceneManager.animate()};H.instance=this,this._model=new ge,this._sceneManager=new I;let e=this._sceneManager.init();e&&this.signals.ready.add(this.startAnimating),this._ui=new fe(this._sceneManager,this,e)}static getInstance(){return H.instance||new H}get scene(){return this._sceneManager}get model(){return this._model}},gi=H.getInstance();})();
